<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>發布租貨物件</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style/header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style/post_object.css') }}">
</head>
<body>
  <header>
    <div class="navbar">
      <a class="logo" href="/homepage">
        <img src="https://img.icons8.com/ios-filled/50/ffffff/wallet--v1.png" alt="logo">
        <span>rental house</span>
      </a>
      <nav>
        <ul>
          <li><a href="/my_rentals">rent</a></li>
          <li><a href="#">租屋</a></li>
          <li><a href="/post_object">幫我出租</a></li>
          <li><a href="/login">登出</a></li>
        </ul>
      </nav>
    </div>
  </header>
<!--還需要修改-->>
  <form action="/complete_upload" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
    <div class="form-container">
      <h1>發布租貨物件</h1>
  
      <label>物件名稱</label>
      <input type="text" name="title" placeholder="輸入物件名稱" required>
  
      <label>租貨描述</label>
      <textarea name="description" placeholder="輸入租貨描述" required></textarea>
  
      <label>地點</label>
      <div class="location-row">
        <input type="text" id="locationInput" name="location" placeholder="輸入地址" required>
        <button class="map-icon" type="button" onclick="getLocation()">📍</button>
      </div>
  
      <label>租金(每月)</label>
      <input type="number" name="rent" placeholder="輸入租金" required> <span class="unit">NTD</span>
  
      <label>押金</label>
      <input type="number" name="deposit" placeholder="輸入押金" required>
  
      <label>租貨日期</label>
      <div class="date-row">
        <input type="date" name="start_date" required>
        <input type="date" name="end_date" required>
      </div>
  
      <label for="fileInput">物件照片上傳</label>
      <div class="upload-area">
        <img id="preview" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/480px-No_image_available.svg.png" width="200" />
        <input type="file" id="fileInput" name="photo" style="display: none;" accept="image/*" required />
        <button type="button" onclick="document.getElementById('fileInput').click()">選擇檔案</button>
      </div>
  
      <div class="btn-group">
        <button type="reset" class="cancel">取消</button>
        <button type="submit" class="submit">發布租貨物件</button>
      </div>
    </div>
  </form>
  
  <!--JavaScript-->
  <script>
  function validateForm() {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
      alert("請上傳照片！");
      return false;
    }
    return true;
  }
  
  // 圖片預覽功能
  document.getElementById('fileInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const imgUrl = URL.createObjectURL(file);
      document.getElementById('preview').src = imgUrl;
    }
  });
  
  // GPS 自動填地址
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(success, error);
    } else {
      alert("瀏覽器不支援地理定位功能");
    }
  }
  
  function success(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
  
    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`)
      .then(response => response.json())
      .then(data => {
        const address = data.display_name;
        document.getElementById('locationInput').value = address;
      })
      .catch(err => {
        alert("地址查詢失敗：" + err);
      });
  }
  
  function error(err) {
    alert("定位失敗：" + err.message);
  }
  </script>
  
</body>
</html>